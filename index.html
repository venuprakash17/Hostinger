<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- CRITICAL: Force no caching of this page -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>SvnaJobs - College & Placement Management Platform</title>
    <meta name="description" content="Complete SaaS platform for college placement management with resume builder, coding practice, and analytics" />
    <meta name="author" content="SvnaJobs" />

    <meta property="og:title" content="SvnaJobs - Smart Placement Management" />
    <meta property="og:description" content="Platform for students, faculty, and colleges to manage placements efficiently" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <!-- CRITICAL: Fetch interceptor - MUST run before ANY other script -->
    <script>
      (function() {
        'use strict';
        // Store original fetch IMMEDIATELY
        const originalFetch = window.fetch;
        const hostname = window.location.hostname;
        
        // Determine correct API URL
        let correctApiUrl = '';
        if (hostname === 'svnaprojob.online' || hostname === 'www.svnaprojob.online') {
          correctApiUrl = 'https://svnaprojob.online/api/v1';
        } else if (hostname === 'localhost' || hostname === '127.0.0.1') {
          correctApiUrl = 'http://localhost:8000/api/v1';
        } else {
          correctApiUrl = 'https://svnaprojob.online/api/v1';
        }
        
        // Store globally
        window.__CORRECT_API_URL__ = correctApiUrl;
        console.log('[Preload] âœ… API URL set:', correctApiUrl);
        
        // Intercept ALL fetch calls
        window.fetch = function(input, init) {
          let url = '';
          if (typeof input === 'string') {
            url = input;
          } else if (input instanceof URL) {
            url = input.toString();
          } else if (input && input.url) {
            url = input.url;
          } else {
            return originalFetch.apply(this, arguments);
          }
          
          // ABSOLUTE BLOCK: Replace old IP immediately
          if (url.includes('72.60.101.14:8000')) {
            console.error('[Preload] ðŸš¨ BLOCKED old IP! Original:', url);
            url = url.replace(/https?:\/\/72\.60\.101\.14:8000(\/api\/v1)?/g, correctApiUrl);
            url = url.replace(/72\.60\.101\.14:8000/g, 'svnaprojob.online');
            console.log('[Preload] âœ… Replaced with:', url);
            
            // Update input
            if (typeof input === 'string') {
              input = url;
            } else if (input instanceof URL) {
              input = new URL(url);
            } else if (input) {
              input = Object.assign({}, input, { url: url });
            }
          }
          
          return originalFetch.call(this, input, init);
        };
        
        console.log('[Preload] âœ… Fetch interceptor installed');
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // CRITICAL: Force reload if old cached code is detected
      (function() {
        // Wait for scripts to load, then check
        window.addEventListener('load', function() {
          setTimeout(function() {
            // Check if we're loading the correct new build
            const scripts = document.querySelectorAll('script[src*="index-"]');
            let foundOldBuild = false;
            scripts.forEach(function(script) {
              const src = script.getAttribute('src') || '';
              // Old build hashes: D7MacLd2, DMTPXsNz
              if (src.includes('index-D7MacLd2.js') || src.includes('index-DMTPXsNz.js')) {
                foundOldBuild = true;
                console.error('ðŸš¨ OLD CACHED BUILD DETECTED! Forcing reload...');
              }
            });
            
            // Also check if main.tsx fix is present
            if (!window.__CORRECT_API_URL__) {
              console.error('ðŸš¨ URL fix not detected! Forcing reload...');
              foundOldBuild = true;
            }
            
            if (foundOldBuild) {
              // Force hard reload with cache bust
              if (window.location.search.indexOf('nocache') === -1) {
                window.location.href = window.location.href.split('?')[0] + '?nocache=' + Date.now() + '&reload=1';
              } else {
                // If already reloaded once, clear cache and reload
                if ('caches' in window) {
                  caches.keys().then(function(names) {
                    names.forEach(function(name) { caches.delete(name); });
                    window.location.reload(true);
                  });
                } else {
                  window.location.reload(true);
                }
              }
            }
          }, 500);
        });
      })();
    </script>
  </body>
</html>
